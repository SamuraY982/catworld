<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è –ñ–∞–±–∫–∏-–û—Ö–æ—Ç–Ω–∏—Ü—ã</title>
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Font Awesome –¥–ª—è –∏–∫–æ–Ω–æ–∫ (–µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∏–≥—Ä—ã */
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e0f2f7; /* –°–≤–µ—Ç–ª–æ-–≥–æ–ª—É–±–æ–π —Ñ–æ–Ω */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .game-container {
            background-color: #ffffff;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 900px;
            width: 100%;
            align-items: center;
        }

        canvas {
            background-color: #81c784; /* –¶–≤–µ—Ç –≤–æ–¥—ã/–±–æ–ª–æ—Ç–∞ */
            border: 5px solid #4caf50; /* –¢–µ–º–Ω–æ-–∑–µ–ª–µ–Ω–∞—è —Ä–∞–º–∫–∞ */
            border-radius: 15px;
            display: block;
            touch-action: none; /* –û—Ç–∫–ª—é—á–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –∫–∞—Å–∞–Ω–∏—è */
            /* –£–±–∏—Ä–∞–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã, —á—Ç–æ–±—ã JavaScript –º–æ–≥ –∏—Ö —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å */
        }

        .game-info {
            display: flex;
            justify-content: space-around;
            width: 100%;
            padding: 10px 0;
            font-size: 1.25rem;
            font-weight: bold;
            color: #388e3c; /* –¢–µ–º–Ω–æ-–∑–µ–ª–µ–Ω—ã–π —Ç–µ–∫—Å—Ç */
        }

        .game-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .game-button {
            background-color: #66bb6a; /* –Ø—Ä–∫–æ-–∑–µ–ª–µ–Ω–∞—è –∫–Ω–æ–ø–∫–∞ */
            color: white;
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border: none;
        }

        .game-button:hover {
            background-color: #4caf50; /* –¢–µ–º–Ω–µ–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(0, 0, 0, 0.3);
        }

        .game-button:active {
            transform: translateY(0);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }

        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            width: 90%;
            transform: translateY(-20px);
            transition: transform 0.3s ease-in-out;
        }

        .modal-overlay.visible .modal-content {
            transform: translateY(0);
        }

        .modal-content h2 {
            font-size: 2.2rem;
            color: #388e3c;
            margin-bottom: 15px;
        }

        .modal-content p {
            font-size: 1.2rem;
            color: #555;
            margin-bottom: 25px;
        }

        .modal-content button {
            background-color: #66bb6a;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
            border: none;
        }

        .modal-content button:hover {
            background-color: #4caf50;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        @media (max-width: 768px) {
            .game-container {
                padding: 15px;
            }
            .game-info {
                font-size: 1rem;
                flex-direction: column;
                gap: 5px;
                text-align: center;
            }
            .game-button {
                padding: 10px 20px;
                font-size: 1rem;
            }
            .modal-content h2 {
                font-size: 1.8rem;
            }
            .modal-content p {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1 class="text-4xl font-extrabold text-green-700 mb-4 text-center">–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è –ñ–∞–±–∫–∏-–û—Ö–æ—Ç–Ω–∏—Ü—ã</h1>
        <div class="game-info">
            <div id="score">–ú—É—Ö–∏: 0</div>
            <div id="level">–£—Ä–æ–≤–µ–Ω—å: 1</div>
            <div id="lives">–ñ–∏–∑–Ω–∏: 3</div>
        </div>
        <canvas id="gameCanvas"></canvas> <!-- –£–±—Ä–∞–Ω—ã width –∏ height –∏–∑ HTML -->

        <!-- –°–∫—Ä—ã—Ç—ã–π input type="file" –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ –∂–∞–±–∫–∏ (–±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è, –Ω–æ –æ—Å—Ç–∞–≤–ª–µ–Ω –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è) -->
        <input type="file" id="hiddenFrogFileInput" accept="image/*" class="hidden">

        <div class="game-controls">
            <button id="startButton" class="game-button">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
            <button id="resetButton" class="game-button hidden">–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å</button>
            <button id="mainMenuButton" class="game-button hidden">–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π -->
    <div id="gameModal" class="modal-overlay">
        <div class="modal-content">
            <h2 id="modalTitle"></h2>
            <p id="modalMessage"></p>
            <button id="modalCloseButton">–û–ö</button>
        </div>
    </div>

    <script>
        // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã DOM
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score');
        const levelDisplay = document.getElementById('level');
        const livesDisplay = document.getElementById('lives');
        const startButton = document.getElementById('startButton');
        const resetButton = document.getElementById('resetButton');
        const mainMenuButton = document.getElementById('mainMenuButton');
        const gameModal = document.getElementById('gameModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const modalCloseButton = document.getElementById('modalCloseButton');
        const hiddenFrogFileInput = document.getElementById('hiddenFrogFileInput'); // –ü–æ–ª—É—á–∞–µ–º —Å–∫—Ä—ã—Ç—ã–π input file

        // –†–∞–∑–º–µ—Ä—ã –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
        const GRID_SIZE = 20; // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–≤–∞–¥—Ä–∞—Ç–∏–∫–æ–≤ –ø–æ —à–∏—Ä–∏–Ω–µ –∏ –≤—ã—Å–æ—Ç–µ
        let CELL_SIZE; // –†–∞–∑–º–µ—Ä –æ–¥–Ω–æ–≥–æ –∫–≤–∞–¥—Ä–∞—Ç–∏–∫–∞ –±—É–¥–µ—Ç –≤—ã—á–∏—Å–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let frog = { x: 0, y: 0, lives: 3 };
        let flies = [];
        let holes = [];
        let predators = [];
        let score = 0;
        let level = 1;
        let gameOver = false;
        let gameStarted = false;
        let predatorMovementInterval = null; // –ò–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –¥–≤–∏–∂–µ–Ω–∏—è —Ö–∏—â–Ω–∏–∫–æ–≤
        let frogImage = new Image(); // –û–±—ä–µ–∫—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –∂–∞–±–∫–∏
        let isFrogImageLoaded = false; // –§–ª–∞–≥ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

        // --- –ú–µ—Å—Ç–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∂–∞–±–∫–∏ ---
        // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ URL –≤–∞—à–µ–≥–æ —Ñ–æ—Ç–æ –∂–∞–±–∫–∏ –∑–¥–µ—Å—å.
        // –≠—Ç–æ —Ñ–æ—Ç–æ –±—ã–ª–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –≤–∞–º–∏: –∂–∞–±.png
        frogImage.src = '/Image/–∂–∞–±.png'; 
        // --------------------------------------------------

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É—Ä–æ–≤–Ω–µ–π
        const levelsConfig = [
            // –£—Ä–æ–≤–µ–Ω—å 1: –ó–º–µ–∏
            { fliesToEat: 5, holes: 10, predators: [{ type: 'snake', count: 1, speed: 500 }] },
            // –£—Ä–æ–≤–µ–Ω—å 2: –ó–º–µ–∏ –∏ –ï–∂–∏
            { fliesToEat: 7, holes: 15, predators: [{ type: 'snake', count: 1, speed: 480 }, { type: 'hedgehog', count: 1, speed: 550 }] },
            // –£—Ä–æ–≤–µ–Ω—å 3: –ó–º–µ–∏, –ï–∂–∏, –¶–∞–ø–ª–∏
            { fliesToEat: 10, holes: 20, predators: [{ type: 'snake', count: 1, speed: 460 }, { type: 'hedgehog', count: 1, speed: 520 }, { type: 'heron', count: 1, speed: 750 }] },
            // –£—Ä–æ–≤–µ–Ω—å 4: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∑–º–µ–π
            { fliesToEat: 8, holes: 18, predators: [{ type: 'snake', count: 2, speed: 440 }, { type: 'hedgehog', count: 1, speed: 500 }, { type: 'heron', count: 1, speed: 700 }] },
            // –£—Ä–æ–≤–µ–Ω—å 5: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –µ–∂–µ–π
            { fliesToEat: 10, holes: 22, predators: [{ type: 'snake', count: 2, speed: 420 }, { type: 'hedgehog', count: 2, speed: 480 }, { type: 'heron', count: 1, speed: 650 }] },
            // –£—Ä–æ–≤–µ–Ω—å 6: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ü–∞–ø–µ–ª—å
            { fliesToEat: 12, holes: 25, predators: [{ type: 'snake', count: 2, speed: 400 }, { type: 'hedgehog', count: 2, speed: 460 }, { type: 'heron', count: 2, speed: 600 }] },
            // –£—Ä–æ–≤–µ–Ω—å 7: –ë–æ–ª—å—à–µ –∑–º–µ–π
            { fliesToEat: 10, holes: 28, predators: [{ type: 'snake', count: 3, speed: 380 }, { type: 'hedgehog', count: 2, speed: 440 }, { type: 'heron', count: 2, speed: 580 }] },
            // –£—Ä–æ–≤–µ–Ω—å 8: –ë–æ–ª—å—à–µ –µ–∂–µ–π
            { fliesToEat: 12, holes: 30, predators: [{ type: 'snake', count: 3, speed: 360 }, { type: 'hedgehog', count: 3, speed: 420 }, { type: 'heron', count: 2, speed: 560 }] },
            // –£—Ä–æ–≤–µ–Ω—å 9: –ë–æ–ª—å—à–µ —Ü–∞–ø–µ–ª—å
            { fliesToEat: 15, holes: 33, predators: [{ type: 'snake', count: 3, speed: 340 }, { type: 'hedgehog', count: 3, speed: 400 }, { type: 'heron', count: 3, speed: 540 }] },
            // –£—Ä–æ–≤–µ–Ω—å 10: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Å–µ—Ö
            { fliesToEat: 13, holes: 35, predators: [{ type: 'snake', count: 4, speed: 320 }, { type: 'hedgehog', count: 4, speed: 380 }, { type: 'heron', count: 3, speed: 520 }] },
            // –£—Ä–æ–≤–µ–Ω—å 11: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Å–µ—Ö
            { fliesToEat: 15, holes: 38, predators: [{ type: 'snake', count: 4, speed: 300 }, { type: 'hedgehog', count: 4, speed: 360 }, { type: 'heron', count: 4, speed: 500 }] },
            // –£—Ä–æ–≤–µ–Ω—å 12: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Å–µ—Ö
            { fliesToEat: 18, holes: 40, predators: [{ type: 'snake', count: 5, speed: 280 }, { type: 'hedgehog', count: 5, speed: 340 }, { type: 'heron', count: 4, speed: 480 }] },
            // –£—Ä–æ–≤–µ–Ω—å 13: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Å–µ—Ö
            { fliesToEat: 16, holes: 42, predators: [{ type: 'snake', count: 5, speed: 260 }, { type: 'hedgehog', count: 5, speed: 320 }, { type: 'heron', count: 5, speed: 460 }] },
            // –£—Ä–æ–≤–µ–Ω—å 14: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Å–µ—Ö
            { fliesToEat: 18, holes: 45, predators: [{ type: 'snake', count: 6, speed: 240 }, { type: 'hedgehog', count: 6, speed: 300 }, { type: 'heron', count: 5, speed: 440 }] },
            // –£—Ä–æ–≤–µ–Ω—å 15: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Å–µ—Ö
            { fliesToEat: 20, holes: 48, predators: [{ type: 'snake', count: 6, speed: 220 }, { type: 'hedgehog', count: 6, speed: 280 }, { type: 'heron', count: 6, speed: 420 }] },
            // –£—Ä–æ–≤–µ–Ω—å 16: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Å–µ—Ö
            { fliesToEat: 19, holes: 50, predators: [{ type: 'snake', count: 7, speed: 200 }, { type: 'hedgehog', count: 7, speed: 260 }, { type: 'heron', count: 6, speed: 400 }] },
            // –£—Ä–æ–≤–µ–Ω—å 17: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Å–µ—Ö
            { fliesToEat: 21, holes: 52, predators: [{ type: 'snake', count: 7, speed: 180 }, { type: 'hedgehog', count: 7, speed: 240 }, { type: 'heron', count: 7, speed: 380 }] },
            // –£—Ä–æ–≤–µ–Ω—å 18: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Å–µ—Ö
            { fliesToEat: 23, holes: 55, predators: [{ type: 'snake', count: 8, speed: 160 }, { type: 'hedgehog', count: 8, speed: 220 }, { type: 'heron', count: 7, speed: 360 }] },
            // –£—Ä–æ–≤–µ–Ω—å 19: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Å–µ—Ö
            { fliesToEat: 22, holes: 58, predators: [{ type: 'snake', count: 8, speed: 140 }, { type: 'hedgehog', count: 8, speed: 200 }, { type: 'heron', count: 8, speed: 340 }] },
            // –£—Ä–æ–≤–µ–Ω—å 20: –§–∏–Ω–∞–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ (–º–∞–∫—Å–∏–º—É–º —Ö–∏—â–Ω–∏–∫–æ–≤ –∏ —Å–∫–æ—Ä–æ—Å—Ç—å)
            { fliesToEat: 25, holes: 60, predators: [{ type: 'snake', count: 9, speed: 120 }, { type: 'hedgehog', count: 9, speed: 180 }, { type: 'heron', count: 9, speed: 300 }] }
        ];

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function showModal(title, message, onConfirm = null) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            gameModal.classList.add('visible');
            modalCloseButton.onclick = () => {
                gameModal.classList.remove('visible');
                if (onConfirm) onConfirm();
            };
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞–∑–º–µ—Ä–∞ canvas
        function setupCanvasSize() {
            const containerWidth = canvas.parentElement.clientWidth;
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —à–∏—Ä–∏–Ω—É –∏ –≤—ã—Å–æ—Ç—É canvas, —Å–æ—Ö—Ä–∞–Ω—è—è –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏
            // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ 600px, –Ω–æ –Ω–µ –±–æ–ª–µ–µ 90% –æ—Ç —à–∏—Ä–∏–Ω—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
            const size = Math.min(600, containerWidth * 0.9);
            canvas.width = size;
            canvas.height = size;
            CELL_SIZE = canvas.width / GRID_SIZE;
            draw(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –ø–æ–ª–µ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∂–∞–±–∫–∏ –∏–∑ —Ñ–∞–π–ª–∞ (—Ç–µ–ø–µ—Ä—å –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
        function loadFrogImageFromDevice() {
            // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –±–æ–ª—å—à–µ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏,
            // —Ç–∞–∫ –∫–∞–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å –∑–∞–¥–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ frogImage.src.
            // –û–¥–Ω–∞–∫–æ, –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–Ω–æ–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞,
            // –≤—ã –º–æ–∂–µ—Ç–µ –≤—ã–∑–≤–∞—Ç—å hiddenFrogFileInput.click() –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ.
            hiddenFrogFileInput.click();
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –≤ input type="file" (–æ—Å—Ç–∞–µ—Ç—Å—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞, –µ—Å–ª–∏ loadFrogImageFromDevice() –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–∞)
        hiddenFrogFileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    frogImage.src = e.target.result;
                    frogImage.onload = () => {
                        isFrogImageLoaded = true;
                        draw(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º, –∫–æ–≥–¥–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ
                    };
                    frogImage.onerror = () => {
                        isFrogImageLoaded = false; // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                        console.error("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∂–∞–±–∫–∏ –∏–∑ —Ñ–∞–π–ª–∞.");
                        draw(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –±–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                    };
                };
                reader.onerror = () => {
                    isFrogImageLoaded = false;
                    console.error("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞.");
                    draw();
                };
                reader.readAsDataURL(file); // –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª –∫–∞–∫ Data URL (Base64)
            } else {
                isFrogImageLoaded = false; // –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                draw();
                console.warn("–í—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º.");
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initializeGame() {
            score = 0;
            level = 1;
            frog.lives = 3;
            gameOver = false;
            gameStarted = false;
            updateGameInfo();
            resetButton.classList.add('hidden');
            mainMenuButton.classList.add('hidden'); // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"
            startButton.classList.remove('hidden'); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É"
            clearInterval(predatorMovementInterval); // –û—á–∏—â–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
            setupCanvasSize(); // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä canvas –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–æ –ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ —á–µ—Ä–µ–∑ frogImage.src
            frogImage.onload = () => {
                isFrogImageLoaded = true;
                draw();
            };
            frogImage.onerror = () => {
                isFrogImageLoaded = false;
                console.error("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∂–∞–±–∫–∏ –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–º—É URL.");
                draw(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –±–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            };
            // –ï—Å–ª–∏ src —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å
            if (frogImage.src && frogImage.src !== window.location.href) {
                // –ï—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ (–∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø–æ–ø—ã—Ç–æ–∫ –∏–ª–∏ –∫—ç—à–∞),
                // —Ç–æ onload/onerror –º–æ–≥—É—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞—Ç—å, –ø–æ—ç—Ç–æ–º—É –ø—Ä–æ–≤–µ—Ä—è–µ–º complete.
                if (frogImage.complete && frogImage.naturalWidth !== 0) {
                    isFrogImageLoaded = true;
                    draw();
                } else if (frogImage.complete && frogImage.naturalWidth === 0) {
                    isFrogImageLoaded = false;
                    console.error("–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∂–∞–±–∫–∏ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–ø—É—Å—Ç–æ–µ).");
                    draw();
                }
                // –ï—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ, onload/onerror —Å—Ä–∞–±–æ—Ç–∞—é—Ç.
            } else {
                isFrogImageLoaded = false; // –ï—Å–ª–∏ src –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –Ω–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                draw();
            }
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        function startGame() {
            gameStarted = true;
            gameOver = false;
            startButton.classList.add('hidden');
            resetButton.classList.remove('hidden');
            mainMenuButton.classList.remove('hidden'); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"
            loadLevel(level);
            gameLoop();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —É—Ä–æ–≤–Ω—è
        function loadLevel(levelNum) {
            if (levelNum > levelsConfig.length) {
                // –ï—Å–ª–∏ –≤—Å–µ —É—Ä–æ–≤–Ω–∏ –ø—Ä–æ–π–¥–µ–Ω—ã
                showModal('–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!', '–í—ã –ø—Ä–æ—à–ª–∏ –≤—Å–µ —É—Ä–æ–≤–Ω–∏! –í—ã –Ω–∞—Å—Ç–æ—è—â–∞—è –∂–∞–±–∫–∞-–æ—Ö–æ—Ç–Ω–∏—Ü–∞!', initializeGame);
                return;
            }

            const config = levelsConfig[levelNum - 1];
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ–ª–µ
            generateBoard(config.holes);
            
            // –†–∞–∑–º–µ—â–∞–µ–º –∂–∞–±–∫—É –≤ —Å–ª—É—á–∞–π–Ω–æ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ
            placeFrogRandomly();

            // –†–∞–∑–º–µ—â–∞–µ–º –º—É—Ö
            placeFlies(config.fliesToEat);

            // –†–∞–∑–º–µ—â–∞–µ–º —Ö–∏—â–Ω–∏–∫–æ–≤
            placePredators(config.predators); // –ü–µ—Ä–µ–¥–∞–µ–º –º–∞—Å—Å–∏–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π —Ö–∏—â–Ω–∏–∫–æ–≤

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –Ω–∞ —ç–∫—Ä–∞–Ω–µ
            updateGameInfo();

            // –ó–∞–ø—É—Å–∫–∞–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ —Ö–∏—â–Ω–∏–∫–æ–≤
            clearInterval(predatorMovementInterval); // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª
            // –í—ã—á–∏—Å–ª—è–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å —Å–∞–º–æ–≥–æ –±—ã—Å—Ç—Ä–æ–≥–æ —Ö–∏—â–Ω–∏–∫–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
            let fastestPredatorSpeed = Infinity;
            config.predators.forEach(p => {
                if (p.speed < fastestPredatorSpeed) {
                    fastestPredatorSpeed = p.speed;
                }
            });
            predatorMovementInterval = setInterval(movePredators, fastestPredatorSpeed);
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è (–∫—É–≤—à–∏–Ω–∫–∏ –∏ –¥—ã—Ä—ã)
        function generateBoard(numHoles) {
            holes = [];
            let attempts = 0;
            const maxAttempts = GRID_SIZE * GRID_SIZE * 2; // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞

            while (holes.length < numHoles && attempts < maxAttempts) {
                const x = Math.floor(Math.random() * GRID_SIZE);
                const y = Math.floor(Math.random() * GRID_SIZE);
                const isOccupied = holes.some(h => h.x === x && h.y === y);

                if (!isOccupied) {
                    holes.push({ x, y });
                }
                attempts++;
            }
        }

        // –†–∞–∑–º–µ—â–µ–Ω–∏–µ –∂–∞–±–∫–∏ –≤ —Å–ª—É—á–∞–π–Ω–æ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ
        function placeFrogRandomly() {
            let placed = false;
            while (!placed) {
                const x = Math.floor(Math.random() * GRID_SIZE);
                const y = Math.floor(Math.random() * GRID_SIZE);
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ–±—ã –∂–∞–±–∫–∞ –Ω–µ –ø–æ—è–≤–∏–ª–∞—Å—å –≤ –¥—ã—Ä–µ –∏–ª–∏ –Ω–∞ —Ö–∏—â–Ω–∏–∫–µ
                if (!holes.some(h => h.x === x && h.y === y) &&
                    !predators.some(p => p.x === x && p.y === y)) {
                    frog.x = x;
                    frog.y = y;
                    placed = true;
                }
            }
        }

        // –†–∞–∑–º–µ—â–µ–Ω–∏–µ –º—É—Ö
        function placeFlies(count) {
            flies = [];
            let attempts = 0;
            const maxAttempts = GRID_SIZE * GRID_SIZE * 2;

            while (flies.length < count && attempts < maxAttempts) {
                const x = Math.floor(Math.random() * GRID_SIZE);
                const y = Math.floor(Math.random() * GRID_SIZE);
                // –ú—É—Ö–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –¥—ã—Ä–∞—Ö, –Ω–∞ –∂–∞–±–∫–µ –∏–ª–∏ –Ω–∞ –¥—Ä—É–≥–∏—Ö –º—É—Ö–∞—Ö
                const isOccupied = holes.some(h => h.x === x && h.y === y) ||
                                   (frog.x === x && frog.y === y) ||
                                   flies.some(f => f.x === x && f.y === y);
                if (!isOccupied) {
                    flies.push({ x, y });
                }
                attempts++;
            }
        }

        // –†–∞–∑–º–µ—â–µ–Ω–∏–µ —Ö–∏—â–Ω–∏–∫–æ–≤
        function placePredators(predatorConfigs) {
            predators = []; // –û—á–∏—â–∞–µ–º –º–∞—Å—Å–∏–≤ —Ö–∏—â–Ω–∏–∫–æ–≤ –¥–ª—è –Ω–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è
            // –î–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è –¥–æ–±–∞–≤–ª—è–µ–º —Ö–∏—â–Ω–∏–∫–æ–≤ –∏–∑ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
            predatorConfigs.forEach(pConfig => {
                for (let i = 0; i < pConfig.count; i++) {
                    let placed = false;
                    let currentAttempts = 0;
                    const maxPlacementAttempts = GRID_SIZE * GRID_SIZE * 2; // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è
                    while (!placed && currentAttempts < maxPlacementAttempts) {
                        const x = Math.floor(Math.random() * GRID_SIZE);
                        const y = Math.floor(Math.random() * GRID_SIZE);
                        // –•–∏—â–Ω–∏–∫–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –¥—ã—Ä–∞—Ö, –Ω–∞ –∂–∞–±–∫–µ, –Ω–∞ –º—É—Ö–∞—Ö –∏–ª–∏ –Ω–∞ –¥—Ä—É–≥–∏—Ö —Ö–∏—â–Ω–∏–∫–∞—Ö
                        const isOccupied = holes.some(h => h.x === x && h.y === y) ||
                                           (frog.x === x && frog.y === y) ||
                                           flies.some(f => f.x === x && f.y === y) ||
                                           predators.some(p => p.x === x && p.y === y);
                        if (!isOccupied) {
                            predators.push({ x, y, type: pConfig.type }); // –î–æ–±–∞–≤–ª—è–µ–º —Ö–∏—â–Ω–∏–∫–∞ —Å –µ–≥–æ —Ç–∏–ø–æ–º
                            placed = true;
                        }
                        currentAttempts++;
                    }
                }
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
        function updateGameInfo() {
            scoreDisplay.textContent = `–ú—É—Ö–∏: ${score}`;
            levelDisplay.textContent = `–£—Ä–æ–≤–µ–Ω—å: ${level}`;
            livesDisplay.textContent = `–ñ–∏–∑–Ω–∏: ${frog.lives}`;
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è –∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
        function draw() {
            // –û—á–∏—â–∞–µ–º —Ö–æ–ª—Å—Ç
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // –†–∏—Å—É–µ–º –∫—É–≤—à–∏–Ω–∫–∏ (–∑–µ–ª–µ–Ω—ã–µ –∫–≤–∞–¥—Ä–∞—Ç–∏–∫–∏)
            for (let y = 0; y < GRID_SIZE; y++) {
                for (let x = 0; x < GRID_SIZE; x++) {
                    ctx.fillStyle = '#9ccc65'; // –°–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –∫—É–≤—à–∏–Ω–æ–∫
                    ctx.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
                    ctx.strokeStyle = '#8bc34a'; // –¢–µ–º–Ω–µ–µ –∑–µ–ª–µ–Ω—ã–π –¥–ª—è –≥—Ä–∞–Ω–∏—Ü
                    ctx.strokeRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
                }
            }

            // –†–∏—Å—É–µ–º –¥—ã—Ä—ã
            holes.forEach(hole => {
                ctx.fillStyle = '#42a5f5'; // –°–∏–Ω–∏–π —Ü–≤–µ—Ç –¥–ª—è –≤–æ–¥—ã/–¥—ã—Ä
                ctx.fillRect(hole.x * CELL_SIZE, hole.y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
                // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç "–¥—ã—Ä—ã" - —Ç–µ–º–Ω—ã–π –∫—Ä—É–≥
                ctx.beginPath();
                ctx.arc(hole.x * CELL_SIZE + CELL_SIZE / 2, hole.y * CELL_SIZE + CELL_SIZE / 2, CELL_SIZE / 3, 0, Math.PI * 2);
                ctx.fillStyle = '#1e88e5'; // –¢–µ–º–Ω–æ-—Å–∏–Ω–∏–π
                ctx.fill();
            });

            // –†–∏—Å—É–µ–º –º—É—Ö
            flies.forEach(fly => {
                ctx.font = `${CELL_SIZE * 0.7}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('ü™∞', fly.x * CELL_SIZE + CELL_SIZE / 2, fly.y * CELL_SIZE + CELL_SIZE / 2); // –≠–º–æ–¥–∑–∏ –º—É—Ö–∏
            });

            // –†–∏—Å—É–µ–º –∂–∞–±–∫—É (–∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –µ—Å–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–æ)
            if (isFrogImageLoaded) {
                ctx.drawImage(frogImage, frog.x * CELL_SIZE, frog.y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
            }
            // –≠–º–æ–¥–∑–∏ –∂–∞–±–∫–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–±—Ä–∞–Ω—ã, –Ω–µ—Ç fallback
            
            // –†–∏—Å—É–µ–º —Ö–∏—â–Ω–∏–∫–æ–≤
            predators.forEach(predator => {
                ctx.font = `${CELL_SIZE * 0.8}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                let emoji;
                switch (predator.type) {
                    case 'snake':
                        emoji = 'üêç'; // –≠–º–æ–¥–∑–∏ –∑–º–µ–∏
                        break;
                    case 'hedgehog':
                        emoji = 'ü¶î'; // –≠–º–æ–¥–∑–∏ –µ–∂–∞
                        break;
                    case 'heron':
                        emoji = 'üê¶'; // –≠–º–æ–¥–∑–∏ –ø—Ç–∏—Ü—ã (—Ü–∞–ø–ª—è)
                        break;
                    default:
                        emoji = '‚ùì';
                }
                ctx.fillText(emoji, predator.x * CELL_SIZE + CELL_SIZE / 2, predator.y * CELL_SIZE + CELL_SIZE / 2);
            });
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–≤–∏–∂–µ–Ω–∏—è –∂–∞–±–∫–∏
        document.addEventListener('keydown', handleKeyPress);
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Å–µ–Ω—Å–æ—Ä–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π (—Å–≤–∞–π–ø—ã)
        let touchStartX = 0;
        let touchStartY = 0;

        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        });

        canvas.addEventListener('touchend', (e) => {
            e.preventDefault();
            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;

            const dx = touchEndX - touchStartX;
            const dy = touchEndY - touchStartY;

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–∞–π–ø–∞
            if (Math.abs(dx) > Math.abs(dy)) { // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø
                if (dx > 0) {
                    moveFrog(0, 1); // –í–ø—Ä–∞–≤–æ
                } else {
                    moveFrog(0, -1); // –í–ª–µ–≤–æ
                }
            } else { // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø
                if (dy > 0) {
                    moveFrog(1, 0); // –í–Ω–∏–∑
                } else {
                    moveFrog(-1, 0); // –í–≤–µ—Ä—Ö
                }
            }
        });


        function handleKeyPress(e) {
            if (!gameStarted || gameOver) return;

            let newX = frog.x;
            let newY = frog.y;

            switch (e.key) {
                case 'ArrowUp':
                    newY--;
                    break;
                case 'ArrowDown':
                    newY++;
                    break;
                case 'ArrowLeft':
                    newX--;
                    break;
                case 'ArrowRight':
                    newX++;
                    break;
            }
            moveFrog(newY - frog.y, newX - frog.x);
        }

        function moveFrog(dy, dx) {
            if (!gameStarted || gameOver) return;

            let newX = frog.x + dx;
            let newY = frog.y + dy;

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã –ø–æ–ª—è
            if (newX >= 0 && newX < GRID_SIZE && newY >= 0 && newY < GRID_SIZE) {
                frog.x = newX;
                frog.y = newY;
                checkCollisions();
                draw();
            }
        }

        // –î–≤–∏–∂–µ–Ω–∏–µ —Ö–∏—â–Ω–∏–∫–æ–≤
        function movePredators() {
            if (gameOver || !gameStarted) return;

            predators.forEach(predator => {
                let newX = predator.x;
                let newY = predator.y;

                switch (predator.type) {
                    case 'snake':
                        // –ó–º–µ—è –¥–≤–∏–∂–µ—Ç—Å—è –∫ –∂–∞–±–∫–µ –ø–æ –æ–¥–Ω–æ–π –∏–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
                        if (Math.abs(frog.x - predator.x) > Math.abs(frog.y - predator.y)) {
                            newX += (frog.x > predator.x ? 1 : -1);
                        } else {
                            newY += (frog.y > predator.y ? 1 : -1);
                        }
                        break;
                    case 'hedgehog':
                        // –ï–∂ –¥–≤–∏–∂–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º
                        const randomDir = Math.floor(Math.random() * 4);
                        if (randomDir === 0) newY--; // –í–≤–µ—Ä—Ö
                        else if (randomDir === 1) newY++; // –í–Ω–∏–∑
                        else if (randomDir === 2) newX--; // –í–ª–µ–≤–æ
                        else if (randomDir === 3) newX++; // –í–ø—Ä–∞–≤–æ
                        break;
                    case 'heron':
                        // –¶–∞–ø–ª—è –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –Ω–∞ —Å–ª—É—á–∞–π–Ω—É—é –ø–æ–∑–∏—Ü–∏—é, –µ—Å–ª–∏ –Ω–µ —Å–ª–∏—à–∫–æ–º –±–ª–∏–∑–∫–æ –∫ –∂–∞–±–∫–µ
                        let moved = false;
                        let attempts = 0;
                        const maxAttempts = GRID_SIZE * GRID_SIZE;
                        while (!moved && attempts < maxAttempts) {
                            const randX = Math.floor(Math.random() * GRID_SIZE);
                            const randY = Math.floor(Math.random() * GRID_SIZE);
                            // –¶–∞–ø–ª—è –Ω–µ –¥–æ–ª–∂–Ω–∞ –ø—Ä—ã–≥–∞—Ç—å –≤ –¥—ã—Ä—É
                            if (!holes.some(h => h.x === randX && h.y === randY)) {
                                newX = randX;
                                newY = randY;
                                moved = true;
                            }
                            attempts++;
                        }
                        break;
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã –¥–ª—è —Ö–∏—â–Ω–∏–∫–æ–≤
                if (newX >= 0 && newX < GRID_SIZE && newY >= 0 && newY < GRID_SIZE) {
                    // –•–∏—â–Ω–∏–∫–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –ø—Ä—ã–≥–∞—Ç—å –≤ –¥—ã—Ä—ã
                    if (!holes.some(h => h.x === newX && h.y === newY)) {
                        predator.x = newX;
                        predator.y = newY;
                    }
                }
            });
            checkCollisions();
            draw();
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π
        function checkCollisions() {
            // –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å –¥—ã—Ä–æ–π
            if (holes.some(hole => hole.x === frog.x && hole.y === frog.y)) {
                frog.lives--;
                updateGameInfo();
                if (frog.lives <= 0) {
                    endGame('–ü–æ—Ä–∞–∂–µ–Ω–∏–µ!', '–ñ–∞–±–∫–∞ —É–ø–∞–ª–∞ –≤ –¥—ã—Ä—É –∏ –ø–æ—Ç–µ—Ä—è–ª–∞ –≤—Å–µ –∂–∏–∑–Ω–∏.');
                } else {
                    placeFrogRandomly(); // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –∂–∞–±–∫—É –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –º–µ—Å—Ç–æ
                }
                return;
            }

            // –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å –º—É—Ö–æ–π
            const flyIndex = flies.findIndex(fly => fly.x === frog.x && fly.y === frog.y);
            if (flyIndex !== -1) {
                flies.splice(flyIndex, 1); // –£–¥–∞–ª—è–µ–º –º—É—Ö—É
                score++;
                updateGameInfo();
                if (score >= levelsConfig[level - 1].fliesToEat) {
                    // –£—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–π–¥–µ–Ω
                    level++;
                    score = 0; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –º—É—Ö –¥–ª—è –Ω–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è
                    showModal('–£—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–π–¥–µ–Ω!', `–í—ã —Å—ä–µ–ª–∏ –≤—Å–µ—Ö –º—É—Ö –Ω–∞ —É—Ä–æ–≤–Ω–µ ${level - 1}!`, () => loadLevel(level));
                }
            }

            // –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å —Ö–∏—â–Ω–∏–∫–æ–º
            if (predators.some(predator => predator.x === frog.x && predator.y === frog.y)) {
                frog.lives--;
                updateGameInfo();
                if (frog.lives <= 0) {
                    endGame('–ü–æ—Ä–∞–∂–µ–Ω–∏–µ!', '–í–∞—Å –ø–æ–π–º–∞–ª —Ö–∏—â–Ω–∏–∫ –∏ –≤—ã –ø–æ—Ç–µ—Ä—è–ª–∏ –≤—Å–µ –∂–∏–∑–Ω–∏.');
                } else {
                    placeFrogRandomly(); // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –∂–∞–±–∫—É –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –º–µ—Å—Ç–æ
                }
            }
        }

        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã
        function endGame(title, message) {
            gameOver = true;
            gameStarted = false;
            clearInterval(predatorMovementInterval);
            showModal(title, message, initializeGame);
        }

        // –û—Å–Ω–æ–≤–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            if (!gameOver && gameStarted) {
                // draw(); // –†–∏—Å—É–µ—Ç—Å—è –≤ moveFrog –∏ movePredators
                requestAnimationFrame(gameLoop);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
        startButton.addEventListener('click', startGame);
        resetButton.addEventListener('click', initializeGame);
        mainMenuButton.addEventListener('click', () => {
            window.location.href = 'index.html'; 
        });
        modalCloseButton.addEventListener('click', () => gameModal.classList.remove('visible'));
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        window.onload = initializeGame;
        window.addEventListener('resize', setupCanvasSize); // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä canvas –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞

    </script>
</body>
</html>
